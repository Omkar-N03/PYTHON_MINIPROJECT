{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz - QUIZMASTER</title>
    <link rel="stylesheet" href="{% static 'css/create_quiz.css' %}">
</head>
<body>
    <!-- Video Background -->
    <div class="video-background">
        <video autoplay muted loop playsinline>
            <source src="{% static 'videos/BG.mp4' %}" type="video/mp4">
            <track kind="captions" src="{% static 'videos/BG.vtt' %}" srclang="en" label="English" default>
        </video>
    </div>

    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <button class="logo" tabindex="0" onclick="globalThis.location.href='{% url 'quiz:teacher_dashboard' %}'" onkeypress="if(event.key==='Enter')globalThis.location.href='{% url 'quiz:teacher_dashboard' %}'" aria-label="Go to dashboard">
                <div class="logo-icon">
                    <img src="{% static 'images/Logo.png' %}" alt="QUIZMASTER Logo">
                </div>
                <span>QUIZMASTER</span>
            </button>
            <a href="{% url 'quiz:teacher_dashboard' %}" class="back-btn">
                <span>‚Üê</span>
                <span>Back to Dashboard</span>
            </a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title">‚ú® Create New Quiz</h1>
            <p class="page-subtitle">Design an engaging quiz for your students in 3 simple steps</p>
        </div>

        <!-- Progress Container -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line" id="progressLine"></div>
                <div class="step active" data-step="1">
                    <div class="step-circle">
                        <span class="step-number">1</span>
                        <span class="step-check">‚úì</span>
                    </div>
                    <span class="step-label">Basic Info</span>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">
                        <span class="step-number">2</span>
                        <span class="step-check">‚úì</span>
                    </div>
                    <span class="step-label">Questions</span>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">
                        <span class="step-number">3</span>
                        <span class="step-check">‚úì</span>
                    </div>
                    <span class="step-label">Review</span>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form method="POST" action="{% url 'quiz:create_quiz' %}" id="createQuizForm">
                {% csrf_token %}
                
                <!-- Step 1: Basic Information -->
                <div class="form-step active" data-step="1">
                    <div class="step-header">
                        <div class="step-icon">üìù</div>
                        <div>
                            <h2 class="step-title">Basic Information</h2>
                            <p class="step-description">Let's start with the quiz details</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">Quiz Title *</label>
                        <input type="text" id="title" name="title" placeholder="e.g., Introduction to Python Programming" required>
                        <span class="field-hint">Choose a clear, descriptive title</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="category">Subject *</label>
                            <select id="category" name="category" required>
                                <option value="">Select Subject</option>
                                <option value="Programming">üíª Programming</option>
                                <option value="Mathematics">üî¢ Mathematics</option>
                                <option value="Science">üî¨ Science</option>
                                <option value="English">üìö English</option>
                                <option value="History">üìú History</option>
                                <option value="Computer Science">üñ•Ô∏è Computer Science</option>
                                <option value="Other">üéØ Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="difficulty">Difficulty Level *</label>
                            <select id="difficulty" name="difficulty" required>
                                <option value="">Select Level</option>
                                <option value="easy">üü¢ Easy</option>
                                <option value="medium">üü° Medium</option>
                                <option value="hard">üî¥ Hard</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="total_marks">Total Marks *</label>
                            <input type="number" id="total_marks" name="total_marks" placeholder="100" min="1" required>
                            <span class="field-hint">Maximum possible score</span>
                        </div>

                        <div class="form-group">
                            <label for="time_limit">Duration (minutes) *</label>
                            <input type="number" id="time_limit" name="time_limit" placeholder="30" min="1" required>
                            <span class="field-hint">Time allowed for completion</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4" placeholder="Brief description of what this quiz covers..."></textarea>
                        <span class="field-hint">Optional: Add context for your students</span>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="globalThis.location.href='{% url 'quiz:teacher_dashboard' %}'">
                            <span>‚úï</span>
                            <span>Cancel</span>
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            <span>Next: Add Questions</span>
                            <span>‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Questions -->
                <div class="form-step" data-step="2">
                    <div class="step-header">
                        <div class="step-icon">‚ùì</div>
                        <div>
                            <h2 class="step-title">Add Questions</h2>
                            <p class="step-description">Use AI or add questions manually</p>
                        </div>
                    </div>
                    
                    <!-- AI Generation Section -->
                    <div class="ai-generator-section">
                        <div class="ai-header">
                            <div class="ai-icon-wrapper">
                                <div class="ai-icon">ü§ñ</div>
                                <div class="ai-pulse"></div>
                            </div>
                            <div class="ai-title-section">
                                <h3>AI Question Generator</h3>
                                <p>Generate quiz questions automatically using artificial intelligence</p>
                            </div>
                        </div>
                        
                        <div class="ai-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="aiTopic">
                                        <span class="label-icon">üéØ</span>
                                        Topic/Subject Matter *
                                    </label>
                                    <input type="text" id="aiTopic" placeholder="e.g., Python Loops, World War 2, Photosynthesis">
                                    <span class="field-hint">Be specific for better results</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="aiNumQuestions">
                                        <span class="label-icon">üî¢</span>
                                        Number of Questions
                                    </label>
                                    <select id="aiNumQuestions">
                                        <option value="5">5 Questions</option>
                                        <option value="10" selected>10 Questions</option>
                                        <option value="15">15 Questions</option>
                                        <option value="20">20 Questions</option>
                                        <option value="25">25 Questions</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="aiDifficulty">
                                        <span class="label-icon">üìä</span>
                                        Difficulty Level
                                    </label>
                                    <select id="aiDifficulty">
                                        <option value="easy">üü¢ Easy - Basic understanding</option>
                                        <option value="medium" selected>üü° Medium - Intermediate knowledge</option>
                                        <option value="hard">üî¥ Hard - Advanced concepts</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="aiQuestionType">
                                        <span class="label-icon">üìù</span>
                                        Question Type
                                    </label>
                                    <select id="aiQuestionType">
                                        <option value="multiple_choice" selected>Multiple Choice (4 options)</option>
                                        <option value="true_false">True/False</option>
                                        <option value="mixed">Mixed (Both types)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="aiInstructions">
                                    <span class="label-icon">üí°</span>
                                    Additional Instructions (Optional)
                                </label>
                                <textarea id="aiInstructions" rows="3" placeholder="e.g., Focus on practical examples, Include code snippets, Cover chapters 1-5"></textarea>
                            </div>
                            
                            <button type="button" class="btn btn-ai" onclick="generateQuestionsAI()">
                                <span class="btn-icon">‚ú®</span>
                                <span id="generateBtnText">Generate Questions with AI</span>
                            </button>
                        </div>
                        
                        <!-- Loading Indicator -->
                        <div class="ai-loading" id="aiLoading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Generating your questions...</p>
                            <span class="loading-subtext">This may take a few moments</span>
                        </div>
                    </div>
                    
                    <!-- Divider -->
                    <div class="section-divider">
                        <span>OR ADD MANUALLY</span>
                    </div>
                    
                    <!-- Manual Question Addition -->
                    <div class="manual-section">
                        <div id="questionsContainer">
                            <!-- Questions will be added dynamically -->
                        </div>
                        
                        <button type="button" class="add-question-btn" onclick="addQuestion()">
                            <span class="btn-icon-plus">‚ûï</span>
                            <span>Add Question Manually</span>
                        </button>
                    </div>
                    
                    <!-- Questions Summary -->
                    <div class="questions-summary" id="questionsSummary" style="display: none;">
                        <div class="summary-content">
                            <span class="summary-icon">üìù</span>
                            <div class="summary-text">
                                <strong id="questionsCount">0</strong>
                                <span>questions added</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <span>‚Üê</span>
                            <span>Previous</span>
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">
                            <span>Next: Review</span>
                            <span>‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Review & Submit -->
                <div class="form-step" data-step="3">
                    <div class="step-header">
                        <div class="step-icon">‚úÖ</div>
                        <div>
                            <h2 class="step-title">Review & Submit</h2>
                            <p class="step-description">Review your quiz before publishing</p>
                        </div>
                    </div>
                    
                    <div id="reviewContent" class="review-content">
                        <!-- Review content will be populated dynamically -->
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <span>‚Üê</span>
                            <span>Previous</span>
                        </button>
                        <button type="submit" class="btn btn-success">
                            <span>üöÄ</span>
                            <span>Create Quiz</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Pass Django data to JavaScript -->
    <script>
        const djangoData = {
            csrfToken: "{{ csrf_token }}",
            createQuizUrl: "{% url 'quiz:create_quiz' %}"
        };
    </script>
    <script src="{% static 'js/create_quiz.js' %}"></script>
</body>
</html>
